{% extends 'base.html' %}
{% block title %}常用工具{% endblock %}
{% block css %}
<style>
    body{background:#fff;}
    .tools li{width:80px;height:80px;float:left;margin:20px;border-radius:10px;box-shadow: 0 0 4px rgba(0,0,0,.6)}
    .tools li a{color:#333;display:block;width:100%;height:100%;text-align:center;line-height:200px;}
    .qrcode{background:url("/wechatStatic/images/qrcode_ico.jpg") no-repeat center;background-size: 80px;}
    .talk{background:url("/wechatStatic/images/girl.png") no-repeat center;background-size: 120px;}
</style>
{% endblock %}
{% block body %}
<div class="tools">
    <ol>
        <li class="qrcode"><a id="qrcode">扫码</a></li>
        <li class="talk"><a href="/wechat/talk">语音对话</a></li>
    </ol>
</div>

<script type="text/javascript" src="http://res.wx.qq.com/open/js/jweixin-1.2.0.js"></script>
<script type="text/javascript" src="/commonStatic/js/common.js"></script>
<script type="text/javascript" src="/socket.io/socket.io.js"></script>
<script type="text/javascript" src="/wechatStatic/js/handle.qrcode.js"></script>
<script>
    $.ajax({
        url: '/ajax/wxConfig',
        type: 'post',
        data: {'signame': 'tools'},
        success: function(result){
            if(result === 'error'){
                console.log("不能调用微信jssdk,没有签名");
                return;
            }
            wx.config({
                debug: true, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
                appId: result.appid, // 必填，公众号的唯一标识
                timestamp: result.timestamp, // 必填，生成签名的时间戳
                nonceStr: result.noncestr, // 必填，生成签名的随机串
                signature: result.signature,// 必填，签名
                jsApiList: ['scanQRCode'] // 必填，需要使用的JS接口列表
            });
            wx.ready(function(){

            });

            wx.error(function(res){
                alert("抱歉，暂无法使用该功能");
            });

            wx.checkJsApi({
                jsApiList: ['chooseImage'], // 需要检测的JS接口列表，所有JS接口列表见附录2,
                success: function(res) {
                    console.log(res);
                    // 以键值对的形式返回，可用的api值true，不可用为false
                    // 如：{"checkResult":{"chooseImage":true},"errMsg":"checkJsApi:ok"}
                }
            });

        },
        error: function(e){
            console.error(e);
        }
    });
    $("#qrcode").click(function(){
        wx.scanQRCode({
            needResult: 1, // 默认为0，扫描结果由微信处理，1则直接返回扫描结果，
            scanType: ["qrCode","barCode"], // 可以指定扫二维码还是一维码，默认二者都有
            success: function (res) {
                const result = res.resultStr; // 当needResult 为 1 时，扫码返回的结果
                const data = result.split("==");
                handleQRcode(data);
            }
        });
    });
</script>
{% endblock %}